<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Breakout</title>
    <script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>

    <script type="text/javascript">

        var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

        // Schläger
        var racket;
        // Ball
        var ball;
        // Anzahl Leben
        var lives = 3;
        // Blöcke
        var bricks;
        // Punkte
        var score = 0;

        // Text zur Anzeige der Leben
        var livesText;
        // Text zur Anzeige der Punkte
        var scoreText;
        // Geschwindigkeit des Balls
        var ballSpeed = 200;
        // Geschwindigkeit des Schlägers
        var racketSpeed = 200;

        /*
         * Wird von Phaser beim Laden des Spiels aufgerufen.
         */
        function preload() {
            game.load.image('background', 'assets/background.png');
            game.load.image('racket', 'assets/racket.png');
            game.load.image('ball', 'assets/ball.png');
            game.load.image('brick', 'assets/brick.png');
            game.load.image('powerup-speed', 'assets/powerup-speed.png');
            game.load.image('powerup-size', 'assets/powerup-size.png');
        }

        /*
         * Wird von Phaser beim Spielstart aufgerufen.
         */
        function create() {
            // Physik starten
            game.physics.startSystem(Phaser.Physics.ARCADE);

            // Wir ignorieren die untere Bildschirmkante bei der Kollisionsberechnung
            game.physics.arcade.checkCollision.down = false;

            // Schläger erstellen
            racket = game.add.sprite(game.world.centerX - 30, game.world.height - 20, 'racket');
            game.physics.arcade.enable(racket);
            // Gravitation & Impuls wirkt nicht auf den Schläger
            racket.body.immovable = true;
            // Schläger kann nicht aus der Welt bewegt werden
            racket.body.collideWorldBounds = true;

            // Ball erstellen
            ball = game.add.sprite(0, 0, 'ball');
            game.physics.arcade.enable(ball);
            // Ball hat 100% Elastizität und springt perfekt
            ball.body.bounce.y = 1;
            ball.body.bounce.x = 1;
            // Ball über dem Schläger platzieren
            resetBall();

            // Der Ball kann nicht aus der Welt bewegt werden (außer nach unten)
            ball.body.collideWorldBounds = true;

            // Phaser soll überprüfen, wenn der Ball aus der Welt fällt (ist nur unten möglich)
            ball.checkWorldBounds = true;
            // Wenn der Ball unten aus der Welt fällt, rufe onBallLost() auf
            ball.events.onOutOfBounds.add(onBallLost, this);

            // Text, der die Anzahl der Leben anzeigt
            livesText = game.add.text(650, 550, 'lives: ' + lives, { font: "16px Courier New", fill: "#ffffff", align: "left" });

            // Text, der die Punkte anzeigt
            scoreText = game.add.text(32, 550, 'score: 0', { font: "16px Courier New", fill: "#ffffff", align: "left" });

            // Blöcke erstellen (Gruppe von Objekten)
            bricks = game.add.group();
            // Alle Objekte der Gruppen sollen Physik haben
            bricks.enableBody = true;
            bricks.physicsBodyType = Phaser.Physics.ARCADE;

            // Einzelne Blöcke erstellen
            for (var y = 0; y < 4; y++) {
                for (var x = 0; x < 15; x++) {
                    var brick = bricks.create(120 + (x * 36), 100 + (y * 52), 'brick');
                    brick.body.immovable = true;
                }
            }
        }

        /*
         * Setzt den Ball über den Schläger und hält den Ball solange an, bis der Schläger bewegt wird.
         */
        function resetBall() {
            holdBall = true;
            ball.reset(racket.body.x + 30, racket.y - 20);
            ball.body.velocity.x = ballSpeed;
            ball.body.velocity.y = ballSpeed;
        }

        /*
         * Wird von Phaser kontinuierlich aufgerufen.
         */
        function update() {
            // Wurde der Schläger vom Ball getroffen? Falls ja, rufe onBallHitRacket() auf
            game.physics.arcade.collide(ball, racket, onBallHitRacket, null, this);

            // Wurde ein Block von dem Ball getroffen? Falls ja, rufe onBallHitBrick() auf
            game.physics.arcade.collide(ball, bricks, onBallHitBrick, null, this);

            // Vom der Tastatur lesen
            var cursors = game.input.keyboard.createCursorKeys();

            if (cursors.left.isDown) {
                // Links wurde gedrückt, also den Schläger nach links bewegen
                racket.body.velocity.x = -racketSpeed;
            } else if (cursors.right.isDown) {
                // Rechts wurde gedrückt, also den Schläger nach links bewegen
                racket.body.velocity.x = racketSpeed;
            } else {
                // Es wurde keine Taste gedrückt, also Schläger anhalten
                racket.body.velocity.x = 0;
            }
        }
    
        /*
         * Wird aufgerufen, wenn der Ball den Schläger trifft.
         */
        function onBallHitRacket(_ball, _racket) {        
        }

        /*
         * Wird aufgerufen, wenn der Ball einen Block trifft.
         */
        function onBallHitBrick(_ball, brick) {
            // Block löschen
            brick.kill();

            // Punkte erhöhen
            score += 1;
            // Und den Punkte-Text aktualisieren
            scoreText.text = 'score: ' + score;
        }

        /*
         * Wird aufgerufen, wenn der Ball das Spielfeld die untere Kante des Bildschirms erreicht.
         */
        function onBallLost() {
            // Ball auf dem Schläger platzieren
            resetBall();

            // Ein Leben abziehen
            lives--;
            // Und den Text aktualisieren
            livesText.text = 'lives: ' + lives;
        }
    </script>

</body>

</html>